<!DOCTYPE html>
<meta charset="utf-8">

<body>
<h2>Ranks with Friends!</h2>
<h3>Book Rankings</h3>
<svg width="700" height="700" id="graph-container"></svg>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script>
const list1 = "data/allison_books.json";
const list2 = "data/jeffrey_books.json";
const svg = d3.select("#graph-container");
const width = +svg.attr("width");
const height = +svg.attr("height");

const margin = {top: 15, right: 50, bottom: 0, left: 200};
const rankings = ["D-", "D", "D+", "C-", "C", "C+", "B-", "B", "B+", "A-", "A", "A+", "S-", "S"]
const xScale = d3.scaleBand().rangeRound([0, width-margin.right]).padding(0.1),
      yScale = d3.scaleBand().rangeRound([0, height-margin.top]).padding(0.1),
      miniScaler = d3.scaleLinear();
      ratingScale = d3.scaleBand().range([0,1]).domain(rankings);

const focus = svg.append('g')
                 .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

let data;
d3.json("data/allison_books.json").then(function(data1) {
  d3.json("data/jeffrey_books.json").then(function(data2){
    data = [data1, data2];
    console.log(data);
    const friendList = d3.entries(data).map(function(d) { return d.value.friend; });
    console.log(friendList);
    let bookList = {};
    data.forEach(function(d) {
      let entries = d3.entries(d.books);
      entries.map(function(book) {
        if (bookList[book.value.name]) {
          bookList[book.value.name].push({'friend': d.friend, 'rating': book.value.score})
        } else {
          bookList[book.value.name] = [{'friend': d.friend, 'rating': book.value.score}]
        }
      });
    });
    console.log(bookList);

    xScale.domain(friendList);

    focus.selectAll('.table-header')
         .data(friendList)
         .enter()
         .append('text')
         .attr('text-anchor', 'middle')
         .attr('class', 'table-header')
         .attr('x', function(d) { return xScale(d)})
         .text(function(d) { return d});

    miniScaler.range(0, height/bookList.length);
    miniScaler.domain([0,1]); // could get max....
    yScale.domain(bookList); // need to sort this...

  });

});

function getRankingFromScore(score) {
  const step = ratingScale.step()
  return rankings[Math.round(score / step)]
}


</script>
</body>
